<!--  Copyright (C) Intel Corp.  2014.  All Rights Reserved. -->

<!--  Permission is hereby granted, free of charge, to any person obtaining -->
<!--  a copy of this software and associated documentation files (the -->
<!--  "Software"), to deal in the Software without restriction, including -->
<!--  without limitation the rights to use, copy, modify, merge, publish, -->
<!--  distribute, sublicense, and/or sell copies of the Software, and to -->
<!--  permit persons to whom the Software is furnished to do so, subject to -->
<!--  the following conditions: -->

<!--  The above copyright notice and this permission notice (including the -->
<!--  next paragraph) shall be included in all copies or substantial -->
<!--  portions of the Software. -->

<!--  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, -->
<!--  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF -->
<!--  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. -->
<!--  IN NO EVENT SHALL THE COPYRIGHT OWNER(S) AND/OR ITS SUPPLIERS BE -->
<!--  LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION -->
<!--  OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION -->
<!--  WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE. -->

<!--   **********************************************************************/ -->
<!--   * Authors: -->
<!--   *   Mark Janes <mark.a.janes@intel.com> -->
<!--   **********************************************************************/ -->

<build_specification>
  <build_master host="otc-mesa-ci.jf.intel.com" results_dir="/mnt/jenkins/results"/>

  <!-- specified the dependency relationships between projects -->
  <projects>
    
    <!-- each project has a matching subdirectory with a build.py
         which automates the build.  -->

    <project name="drm"/>

    <project name="mesa">
      <prerequisite name="drm"/>
    </project>

    <!-- only works on m64, due to llvm dependencies -->
    <project name="mesa-buildtest" src_dir="mesa">
      <prerequisite name="drm"/>
    </project>

    <project name="waffle">
      <prerequisite name="mesa" hardware="builder"/>
    </project>

    <project name="deqp-test" src_dir="deqp">
      <prerequisite name="deqp" hardware="builder"/>
      <prerequisite name="piglit" hardware="builder"/>
    </project>

    <project name="deqp">
      <prerequisite name="mesa" hardware="builder"/>
      <!-- for wflinfo, to check version support -->
      <prerequisite name="waffle" hardware="builder"/>
    </project>

    <project name="cts">
      <prerequisite name="mesa" hardware="builder"/>
    </project>

    <project name="cts-test">
      <prerequisite name="cts" hardware="builder"/>
      <prerequisite name="piglit" hardware="builder"/>
    </project>

    <project name="piglit">
      <prerequisite name="waffle"/>
    </project>

    <project name="piglit-test">
      <prerequisite name="piglit" hardware="builder"/>
      <prerequisite name="mesa" hardware="builder"/>
    </project>

    <project name="piglit-cpu-test">
      <prerequisite name="piglit" hardware="builder"/>
      <prerequisite name="mesa" hardware="builder"/>
    </project>

    <project name="shaderc"/>

    <project name="crucible">
      <prerequisite name="shaderc"/>
      <prerequisite name="mesa"/>
    </project>

    <project name="crucible-test">
      <prerequisite name="crucible" hardware="builder"/>
    </project>
    
    <!-- all-test has no build.py, and exists only to provide
         dependency relationships. -->
    <project name="all-test">
      <prerequisite name="scons-buildtest" hardware="builder"/>
      <prerequisite name="piglit-test"
                    hardware="ilk,snbgt1,snbgt2,ivbgt2,ivbgt1,hswgt2,bdwgt2,hswgt3e,hswgt1,skl"
                    arch="m64,m32"/>
      <prerequisite only_for_type="daily" name="piglit-test" hardware="bsw,byt,g33,g45,g965,bxt" arch="m64,m32"/>
      <prerequisite only_for_type="daily" name="deqp-full"/>
      <prerequisite name="piglit-cpu-test" hardware="fastgpu" arch="m64,m32"/>
      <prerequisite name="mesa-buildtest" hardware="builder" arch="m64"/>
      <prerequisite name="deqp-test" hardware="hsw,bdwgt3e" arch="m64" shard="2"/>
      <prerequisite name="cts-full"/>
    </project>

    <project name="test-single-arch">
      <prerequisite name="piglit-test" hardware="ilk,g45,g965,snb,ivb,hsw,bdw,skl"/>
      <prerequisite only_for_type="daily" name="piglit-test" hardware="bsw,byt,g33"/>
      <prerequisite name="piglit-cpu-test" hardware="fastgpu"/>
      <prerequisite name="scons-buildtest" hardware="builder" arch="m64"/>
      <prerequisite name="mesa-buildtest" hardware="builder"/>
      <prerequisite name="deqp-test" hardware="hsw,bdwgt3e" arch="m64" shard="2"/>
      <prerequisite name="cts-full"/>
    </project>

    <!-- this is used for ben's percheckin build -->
    <project name="test-single-arch-ben">
      <prerequisite name="piglit-test" hardware="ilk,g45,g965,snb,ivb,hsw,bdw,skl,bsw,byt,bxt"/>
      <prerequisite name="piglit-cpu-test" hardware="fastgpu"/>
      <prerequisite name="scons-buildtest" hardware="builder" arch="m64"/>
      <prerequisite name="mesa-buildtest" hardware="builder"/>
      <prerequisite name="deqp-test" hardware="hsw,bdwgt3e,skl" arch="m64" shard="2"/>
      <prerequisite name="cts-full"/>
    </project>

    <!-- for bisecting failures -->
    <project name="piglit-gpu-all">
      <prerequisite name="piglit-test"
                    arch="m64,m32"
                    hardware="ilk,g45,snb,ivb,hsw,bsw,byt,g965,bdw,g33,skl,bxt"/>
      <prerequisite name="deqp-test" arch="m64" hardware="hsw,snb,bdw,byt,bsw,ivb,skl"/>
      <prerequisite name="cts-test" arch="m64" hardware="ilk,g45,g965,g33,snb,ivb,hsw,bdw,byt,bsw,skl,bxt"/>
    </project>

    <project name="deqp-full">
      <prerequisite name="deqp-test"
                    arch="m64"
                    hardware="hsw,snb,byt,bsw,ivb,skl"
                    shard="5"/>
    </project>

    <project name="cts-full">
      <prerequisite name="cts-test" hardware="snb,ivb,hsw,bdw" arch="m64"/>
      <prerequisite name="cts-test" only_for_type="daily" hardware="g965,g33,ilk,g45,bsw,byt,skl,bxt" arch="m64"/>
    </project>

    <project name="reboot-slaves">
      <prerequisite name="reboot-slave" hardware="bdwgt2-02,bdwgt2-03,bdwgt2-04,bdwgt3e-01,bdwgt3e-02,bdwgt3e-03,bdwgt3e-04,bsw-01,bsw-02,bsw-03,bsw-04,bsw-05,bsw-06,bsw-07,byt-01,byt-02,byt-03,byt-04,byt-05,byt-06,byt-07,bxt-01,g33-01,g33-02,g33-03,g45-01,g965-01,g965-02,hswgt1-01,hswgt1-02,hswgt2-01,hswgt2-02,hswgt2-03,hswgt3e-01,hswgt3e-02,hswgt3e-03,ilk-01,ilk-02,ilk-03,ivbgt1-01,ivbgt1-02,ivbgt2-01,ivbgt2-02,sklgt2-01,sklgt2-02,sklgt2-03,sklgt2-04,sklgt2-05,sklgt2-06,snbgt1-01,snbgt1-02,snbgt1-03,snbgt1-04,snbgt2-01,snbgt2-02"/>
    </project>

    <project name="reboot-slave"/>

    <project name="scons-buildtest"/>

    <project name="clean-workspace"/>
    <!-- TODO: find a way to variablize this list of hardware -->
    <project name="clean-all-workspaces">
      <prerequisite name="clean-workspace" hardware="bdwgt2-02,bdwgt2-03,bdwgt2-04,bdwgt3e-01,bdwgt3e-02,bdwgt3e-03,bdwgt3e-04,bsw-01,bsw-02,bsw-03,bsw-04,bsw-05,bsw-06,bsw-07,byt-01,byt-02,byt-03,byt-04,byt-05,byt-06,byt-07,g33-01,g33-02,g33-03,g45-01,g965-01,g965-02,hswgt1-01,hswgt1-02,hswgt2-01,hswgt2-02,hswgt2-03,hswgt3e-01,hswgt3e-02,hswgt3e-03,ilk-01,ilk-02,ilk-03,ivbgt1-01,ivbgt1-02,ivbgt2-01,ivbgt2-02,sklgt2-01,sklgt2-02,sklgt2-03,sklgt2-04,snbgt1-01,snbgt1-02,snbgt1-03,snbgt2-01,snbgt2-02"/>
    </project>
             
    
  </projects>

  <!-- the following servers and remotes correspond to projects -->
  <repos>
    <mesa repo="git://anongit.freedesktop.org/mesa/mesa">
      <!-- todo: add support for remotes.  -->
      <remote name="jekstrand" repo="git://people.freedesktop.org/~jekstrand/mesa"/>
      <remote name="kwg" repo="git://people.freedesktop.org/~kwg/mesa"/>
      <remote name="krh" repo="git://people.freedesktop.org/~krh/mesa"/>
      <remote name="bwidawsk" repo="git://people.freedesktop.org/~bwidawsk/mesa"/>
      <remote name="idr" repo="git://people.freedesktop.org/~idr/mesa"/>
      <remote name="mattst88" repo="git://people.freedesktop.org/~mattst88/mesa"/>
      <remote name="janesma" repo="git://github.com/janesma/mesa"/>
      <remote name="jljusten" repo="git://people.freedesktop.org/~jljusten/mesa"/>
      <remote name="mperes" repo="git://people.freedesktop.org/~mperes/mesa"/>
      <remote name="tpalli" repo="git://people.freedesktop.org/~tpalli/mesa"/>
      <remote name="curro" repo="git://people.freedesktop.org/~currojerez/mesa"/>
      <remote name="aphogat" repo="git://github.com/aphogat/mesa"/>
      <remote name="tpohjola" repo="git://people.freedesktop.org/~tpohjola/mesa"/>
      <remote name="dcbaker" repo="git://people.freedesktop.org/~dbaker/mesa"/>
      <remote name="nchery" repo="git://people.freedesktop.org/~nchery/mesa"/>
      <remote name="bpeel" repo="git://github.com/bpeel/mesa"/>
      <remote name="chadv" repo="git://github.com/chadversary/mesa"/>
      <remote name="ickle" repo="git://people.freedesktop.org/~ickle/mesa"/>
      <remote name="tarceri" repo="git://github.com/tarceri/Mesa_arrays_of_arrays"/>
      <remote name="evelikov" repo="git://github.com/evelikov/mesa"/>
      <remote name="vulkan" repo="ssh://git@gitlab.khronos.org/vulkan/mesa"/>
    </mesa>

    <drm repo="git://anongit.freedesktop.org/mesa/drm">
      <remote name="aphogat" repo="git://github.com/aphogat/drm"/>
      <remote name="janesma" repo="git://github.com/janesma/drm"/>
    </drm>

    <piglit repo="git://anongit.freedesktop.org/piglit">
      <remote name="jekstrand" repo="git://people.freedesktop.org/~jekstrand/piglit"/>
      <!-- Dylan's repository is more stable than the origin, and will
           not trigger builds unnecessarily -->
      <remote name="dcbaker" repo="git://github.com/dcbaker/piglit"/>
      <remote name="janesma" repo="git://github.com/janesma/piglit"/>
      <remote name="bwidawsk" repo="git://people.freedesktop.org/~bwidawsk/piglit"/>
      <remote name="nchery" repo="git://people.freedesktop.org/~nchery/piglit"/>
      <remote name="chadv" repo="git://github.com/chadversary/piglit"/>
      <remote name="idr" repo="git://people.freedesktop.org/~idr/piglit"/>
      <remote name="bpeel" repo="git://github.com/bpeel/piglit"/>
    </piglit>

    <waffle repo="git://github.com/waffle-gl/waffle">
      <remote name="stable" repo="git://github.com/janesma/waffle"/>
      <remote name="chadv" repo="git://github.com/chadversary/waffle"/>
      <remote name="janesma" repo="git://github.com/janesma/waffle"/>
    </waffle>

    <!-- just so the master can cache it for the builders -->
    <mesa_jenkins repo="git://github.com/janesma/mesa_jenkins.git"/>

    <deqp repo="git://github.com/janesma/deqp.git"
          branch="origin/chadv">
      <remote name="chadv" repo="git://github.com/chadversary/deqp.git"/>
    </deqp>

    <cts repo="ssh://majanes@git-amr-2.devtools.intel.com:29418/otc_gen_graphics-khronos-glconform.git"
         branch="origin/master-gbm"/>

    <prerelease repo="ssh://majanes@git-amr-3.devtools.intel.com:29418/otc_gen_graphics-mesa_ci_prerelease.git"/>

    <shaderc repo="git://github.com/jekstrand/shaderc"
             branch="otc"/>
    <gmock repo="git://github.com/google/googlemock"
           branch="release-1.7.0"/>
    <glslang repo="ssh://git@gitlab.khronos.org:jekstrand/glslang.git"
             branch="otc"/>
    <gtest repo="git://github.com/google/googletest"
           branch="release-1.7.0"/>
    <crucible repo="ssh://majanes@git-amr-3.devtools.intel.com:29418/otc_gen_graphics-crucible"/>
  </repos>


  <branches>
    <!-- the following branches are polled continuously.  Any commit
         will trigger a branch build with an identifier based on the
         commit that triggered the build.  Any repository listed as a
         subtag of the branch can trigger a build of the branch.
         Repositories default to origin/master -->

    <!-- jenkins has a build with same name as branch -->
    <branch name="mesa_master" project="all-test">

      <!-- these repo tags exist soley to trigger a master build when
           anything changes -->
      <mesa/>
      <piglit/>
      <waffle/>
      <drm/>
      <deqp/>
      <cts/>
      <prerelease trigger="false"/>
    </branch>

    <branch name="mesa_11.0" project="all-test">
      <mesa branch="origin/11.0"/>
      <piglit branch="janesma/stable_jenkins" trigger="false"/>
    </branch>

    <branch name="mesa_11.1" project="all-test">
      <mesa branch="origin/11.1"/>
      <piglit branch="janesma/11_1_jenkins" trigger="false"/>
    </branch>

    <branch name="vulkan" project="crucible">
      <mesa branch="vulkan/vulkan"/>
      <crucible/>
      <shaderc/>
      <glslang/>
    </branch>

    <branch name="jekstrand" project="test-single-arch-skl">
      <mesa branch="jekstrand/jenkins"/>
    </branch>

    <branch name="kwg" project="test-single-arch">
      <mesa branch="kwg/jenkins"/>
    </branch>

    <branch name="krh" project="test-single-arch">
      <mesa branch="krh/jenkins"/>
    </branch>

    <branch name="bwidawsk" project="test-single-arch-ben">
      <mesa branch="bwidawsk/jenkins"/>
      <!-- <piglit branch="bwidawsk/jenkins"/> -->
    </branch>

    <branch name="bwidawsk_fast" project="test-single-arch">
      <mesa branch="bwidawsk/fast_jenkins"/>
      <!-- <piglit branch="bwidawsk/jenkins"/> -->
    </branch>

    <branch name="idr" project="test-single-arch">
      <mesa branch="idr/jenkins"/>
    </branch>

    <branch name="mattst88" project="test-single-arch">
      <mesa branch="mattst88/jenkins"/>
    </branch>

    <branch name="majanes" project="test-single-arch">
      <mesa branch="janesma/jenkins"/>
    </branch>

    <branch name="dcbaker" project="test-single-arch">
      <piglit branch="dcbaker/jenkins"/>
    </branch>

    <branch name="chadv" project="test-single-arch">
      <mesa branch="origin/10.3"/>
      <waffle branch="chadv/jenkins"/>
      <deqp branch="chadv/chadv" trigger="false"/>
    </branch>

    <branch name="jljusten" project="test-single-arch">
      <mesa branch="jljusten/jenkins"/>
    </branch>

    <branch name="mperes" project="test-single-arch">
      <mesa branch="mperes/jenkins"/>
    </branch>

    <branch name="tpalli" project="test-single-arch">
      <mesa branch="tpalli/jenkins"/>
    </branch>

    <branch name="curro" project="test-single-arch">
      <mesa branch="curro/jenkins"/>
      <deqp branch="chadv/chadv" trigger="false"/>
    </branch>

    <branch name="aphogat" project="test-single-arch">
      <mesa branch="aphogat/jenkins"/>
      <deqp branch="chadv/chadv" trigger="false"/>
    </branch>

    <branch name="tpohjola" project="test-single-arch">
      <mesa branch="tpohjola/jenkins"/>
      <deqp branch="chadv/chadv" trigger="false"/>
    </branch>

    <branch name="nchery" project="test-single-arch">
      <mesa branch="nchery/jenkins"/>
    </branch>

    <branch name="cwabbott0" project="test-single-arch">
      <mesa branch="cwabbott0/jenkins"/>
    </branch>

    <branch name="bpeel" project="test-single-arch-skl">
      <mesa branch="bpeel/jenkins"/>
    </branch>
    
    <branch name="ickle" project="test-single-arch">
      <mesa branch="ickle/jenkins"/>
    </branch>

    <branch name="tarceri" project="test-single-arch">
      <mesa branch="tarceri/intel_ci"/>
    </branch>

    <branch name="evelikov" project="test-single-arch">
      <mesa branch="evelikov/intel-ci"/>
    </branch>

    <branch name="nir_test_clone" project="test-single-arch"/>

  </branches>

</build_specification>
